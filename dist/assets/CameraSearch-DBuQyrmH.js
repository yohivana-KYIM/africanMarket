const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BEL_EWUy.js","assets/graph_model-CQQgwq5P.js","assets/index-Bma8mCu_.js","assets/index-DnOpJZOi.css","assets/mobilenet.esm-CameJATL.js"])))=>i.map(i=>d[i]);
import{r,e as Q,m as ee,z as S,_ as q,u as te,j as e,A as P,a as t,H as ae,b as W,f as se}from"./index-Bma8mCu_.js";const re=`${Q.API_URL}/api/products`,T={background:"#19110b",color:"#fff",borderRadius:"0",fontSize:"12px"},D={handbag:"sac a main",purse:"sac a main",clutch:"pochette",bag:"sac",shopping_basket:"sac",plastic_bag:"sac",mailbag:"sac",backpack:"sac a dos",knapsack:"sac a dos",pack:"sac a dos",sandal:"sandales",running_shoe:"baskets",sneaker:"baskets",shoe_shop:"chaussures",loafer:"chaussures",boot:"chaussures",clog:"chaussures",oxford:"chaussures",wallet:"portefeuille",billfold:"portefeuille",sunglass:"lunettes",sunglasses:"lunettes",eyeglass:"lunettes",watch:"montre",digital_watch:"montre",analog_clock:"montre",necklace:"bijoux",bracelet:"bijoux",ring:"bijoux",perfume:"parfum",lotion:"parfum",jersey:"vetements",shirt:"vetements",dress:"vetements",suit:"vetements",jean:"vetements",miniskirt:"vetements",skirt:"vetements",coat:"vetements",trench_coat:"vetements",poncho:"vetements",kimono:"vetements",bikini:"vetements",swimming_trunks:"vetements",pajama:"vetements",bow_tie:"vetements",neck_brace:"accessoires",hat:"chapeau",sombrero:"chapeau",cap:"casquette",scarf:"foulard",stole:"foulard",umbrella:"parapluie",belt:"ceinture",buckle:"ceinture"},ie=()=>{const[u,c]=r.useState("idle"),[I,i]=r.useState(""),[B,j]=r.useState([]),[z,y]=r.useState(""),[_,g]=r.useState([]),[U,w]=r.useState(!1),[G,N]=r.useState(""),[$,b]=r.useState("init"),[R,h]=r.useState("capturing"),v=r.useRef(null),E=r.useRef(null),p=r.useRef(null),k=r.useRef(null),H=r.useCallback(s=>{v.current=s,s&&p.current&&!s.srcObject&&(s.srcObject=p.current,s.play().catch(()=>{}))},[]),x=r.useCallback(()=>{p.current&&(p.current.getTracks().forEach(s=>s.stop()),p.current=null)},[]),A=r.useCallback(async s=>{y(s),w(!0);try{const o=await fetch(`${re}?search=${encodeURIComponent(s)}&limit=8`);if(!o.ok)throw new Error("Search failed");const f=await o.json();g(f.products.map(ee))}catch{g([])}finally{w(!1)}},[]),a=s=>{const f=s.toLowerCase().replace(/,/g,"").split(/[\s_]+/);for(const n of s.split(", ")){const m=n.trim().toLowerCase().replace(/\s+/g,"_");if(D[m])return D[m]}for(const n of f)if(D[n])return D[n];return null},C=r.useCallback(async()=>{if(i(""),j([]),g([]),y(""),N(""),b("init"),h("capturing"),!navigator.mediaDevices?.getUserMedia){c("error"),i("Votre navigateur ne supporte pas l'acces a la camera."),S.error("Camera non supportee par ce navigateur",{style:T});return}c("loading-model");try{const s=(f,n,m)=>Promise.race([f,new Promise((Y,L)=>setTimeout(()=>L(new Error(`${m} : delai depasse (${n/1e3}s)`)),n))]),[,o]=await Promise.all([(async()=>{if(k.current)return b("ready"),null;b("tensorflow");const f=await s(q(()=>import("./index-BEL_EWUy.js"),__vite__mapDeps([0,1,2,3])),15e3,"Chargement TensorFlow");await s(f.ready(),1e4,"Initialisation TensorFlow"),b("model");const n=await s(q(()=>import("./mobilenet.esm-CameJATL.js"),__vite__mapDeps([4,1,2,3])),1e4,"Chargement MobileNet"),m=await s(n.load({version:2,alpha:.5}),2e4,"Telechargement du modele");return k.current=m,b("ready"),null})(),(async()=>(b(n=>n==="init"?"camera":n),await navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:"environment"},width:{ideal:640},height:{ideal:480}},audio:!1}).catch(n=>{throw n.name==="NotAllowedError"?new Error("Acces a la camera refuse. Autorisez l'acces dans les parametres."):n.name==="NotFoundError"?new Error("Aucune camera detectee sur cet appareil."):new Error("Impossible d'acceder a la camera. Verifiez vos permissions.")})))()]);p.current=o,S.success("Camera activee",{style:T,icon:"ðŸ“¸"}),c("viewfinder")}catch(s){x(),c("error");const o=s?.message||"Impossible de charger le modele. Verifiez votre connexion.";i(o),S.error(o,{style:T})}},[x]),Z=r.useCallback(async()=>{if(!v.current||!E.current||!k.current)return;h("capturing"),c("capturing");const s=v.current,o=E.current;o.width=s.videoWidth,o.height=s.videoHeight;const f=o.getContext("2d");if(f){f.drawImage(s,0,0),N(o.toDataURL("image/jpeg",.8)),x();try{h("detecting");const n=await k.current.classify(o,5);h("classifying");const m=[],Y=new Set;for(const L of n){const M=a(L.className);M&&!Y.has(M)&&(Y.add(M),m.push({label:L.className.split(",")[0].trim(),searchTerm:M,confidence:Math.round(L.probability*100)}))}if(m.length===0){c("error"),i("Objet non reconnu. Essayez un autre angle ou meilleur eclairage."),S.error("Aucun objet reconnu",{style:T});return}S.success(`${m.length} objet${m.length>1?"s":""} detecte${m.length>1?"s":""}`,{style:T,icon:"âœ“"}),h("searching"),j(m),c("results"),await A(m[0].searchTerm)}catch{c("error");const n="Erreur lors de l'analyse de l'image. Reessayez.";i(n),S.error(n,{style:T})}}},[x,A]),J=r.useCallback(async()=>{j([]),g([]),y(""),N(""),i(""),b("init"),h("capturing"),c("loading-model");try{const s=await navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:"environment"},width:{ideal:640},height:{ideal:480}},audio:!1});p.current=s,c("viewfinder")}catch{c("error"),i("Impossible de reactiver la camera.")}},[]),K=r.useCallback(()=>{x(),c("idle"),i(""),j([]),g([]),y(""),N(""),b("init"),h("capturing")},[x]);return r.useEffect(()=>{if(u!=="viewfinder")return;const s=()=>v.current&&p.current&&!v.current.srcObject?(v.current.srcObject=p.current,v.current.play().catch(()=>{}),!0):!1;if(s())return;const o=setInterval(()=>{s()&&clearInterval(o)},100);return()=>clearInterval(o)},[u]),r.useEffect(()=>()=>{x()},[x]),{state:u,error:I,loadingStage:$,analyzingStage:R,detectedCategories:B,activeSearchTerm:z,results:_,searchLoading:U,capturedImage:G,videoRef:v,connectVideoRef:H,canvasRef:E,open:C,capture:Z,retake:J,close:K,searchProducts:A}},d=[.25,.46,.45,.94],l="#c5a467",ne={init:"Initialisation...",tensorflow:"Chargement TensorFlow...",model:"Telechargement du modele IA...",camera:"Activation de la camera...",ready:"Pret !"},ce={capturing:"Capture de l'image...",detecting:"Detection des objets...",classifying:"Classification en cours...",searching:"Recherche de produits..."},oe={hidden:{opacity:0},visible:{opacity:1,transition:{duration:.4,ease:d}},exit:{opacity:0,transition:{duration:.3,ease:d}}},V={enter:{opacity:0,scale:.96,y:20},center:{opacity:1,scale:1,y:0,transition:{duration:.5,ease:d}},exit:{opacity:0,scale:.94,y:-10,transition:{duration:.3,ease:d}}},le=u=>({animate:{scale:[1,1.8,2.2],opacity:[.6,.2,0],transition:{duration:2.4,repeat:1/0,delay:u,ease:d}}}),de={animate:{y:["0%","100%","0%"],transition:{duration:3,repeat:1/0,ease:"linear"}}},O={animate:{boxShadow:[`0 0 4px ${l}40`,`0 0 12px ${l}80`,`0 0 4px ${l}40`],transition:{duration:2,repeat:1/0,ease:d}}},me={animate:{scale:[1,1.15,1],opacity:[.8,.4,.8],transition:{duration:1.8,repeat:1/0,ease:d}}},ue={initial:{opacity:0},flash:{opacity:[0,1,0],transition:{duration:.4,times:[0,.15,1],ease:d}}},pe={initial:{scale:1.4,opacity:0,borderRadius:"0px"},animate:{scale:1,opacity:1,borderRadius:"12px",transition:{type:"spring",stiffness:300,damping:30}}},he={animate:{rotate:360,transition:{duration:2,repeat:1/0,ease:"linear"}}},xe={hidden:{opacity:0},visible:{opacity:1,transition:{delayChildren:.15,staggerChildren:.08}}},F={hidden:{opacity:0,y:16},visible:{opacity:1,y:0,transition:{duration:.4,ease:d}}},fe={hidden:{opacity:0,scale:.6},visible:{opacity:1,scale:1,transition:{type:"spring",stiffness:500,damping:15}}},X={initial:{x:0},shake:{x:[0,-8,8,-6,6,-3,3,0],transition:{duration:.5}}},ge={animate:{borderColor:["rgba(239,68,68,0.3)","rgba(239,68,68,0.7)","rgba(239,68,68,0.3)"],transition:{duration:1.5,repeat:1/0,ease:d}}},be=u=>{const c=u/8*Math.PI*2,I=Math.cos(c)*60,i=Math.sin(c)*60;return{initial:{x:0,y:0,opacity:1,scale:1},animate:{x:I,y:i,opacity:0,scale:0,transition:{duration:.7,ease:d}}}},ye=({isOpen:u,onClose:c})=>{const I=te(),{state:i,error:B,loadingStage:j,analyzingStage:z,detectedCategories:y,activeSearchTerm:_,results:g,searchLoading:U,capturedImage:w,connectVideoRef:G,canvasRef:N,open:$,capture:b,retake:R,close:h,searchProducts:v}=ie(),[E,p]=r.useState(!1),[k,H]=r.useState(!1);r.useEffect(()=>{u&&i==="idle"&&$(),!u&&i!=="idle"&&h()},[u,i,$,h]),r.useEffect(()=>{if(i==="capturing"){p(!0),navigator.vibrate&&navigator.vibrate(50);const a=setTimeout(()=>p(!1),500);return()=>clearTimeout(a)}},[i]),r.useEffect(()=>{if(i==="results"&&y.length>0){H(!0);const a=setTimeout(()=>H(!1),800);return()=>clearTimeout(a)}},[i,y]);const x=()=>{h(),c()},A=a=>{x(),I(`/product/${a}`)};return u?e.jsx(P,{children:e.jsxs(t.div,{variants:oe,initial:"hidden",animate:"visible",exit:"exit",className:"fixed inset-0 z-[120] bg-[#19110b] flex flex-col",children:[e.jsx(P,{children:E&&e.jsx(t.div,{variants:ue,initial:"initial",animate:"flash",className:"fixed inset-0 z-[130] bg-white pointer-events-none"},"shutter-flash")}),e.jsxs("div",{className:"flex items-center justify-between px-4 sm:px-6 h-14 shrink-0 bg-black/30 backdrop-blur-sm z-10",children:[e.jsx("span",{className:"text-[11px] font-medium tracking-[0.15em] uppercase text-white/80",children:"Recherche Camera"}),e.jsx(t.button,{whileHover:{rotate:90},whileTap:{scale:.9},transition:{duration:.3},onClick:x,className:"text-white p-1.5 hover:bg-white/10 rounded-full transition-colors","aria-label":"Fermer",children:e.jsx(ae,{size:24})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto relative",children:[e.jsx("canvas",{ref:N,className:"hidden"}),e.jsxs(P,{mode:"wait",children:[i==="loading-model"&&e.jsxs(t.div,{variants:V,initial:"enter",animate:"center",exit:"exit",className:"flex flex-col items-center justify-center h-full px-6 text-center",style:{backgroundImage:`radial-gradient(${l}15 1px, transparent 1px)`,backgroundSize:"24px 24px"},children:[e.jsxs("div",{className:"relative w-32 h-32 flex items-center justify-center mb-8",children:[[0,.5,1,1.5].map((a,C)=>e.jsx(t.div,{variants:le(a),animate:"animate",className:"absolute inset-0 rounded-full border-2",style:{borderColor:l}},C)),e.jsx(t.div,{animate:{scale:[1,1.3,1],opacity:[.8,1,.8]},transition:{duration:1.5,repeat:1/0,ease:d},className:"w-4 h-4 rounded-full",style:{backgroundColor:l}})]}),e.jsx(P,{mode:"wait",children:e.jsx(t.p,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},transition:{duration:.3,ease:d},className:"text-[14px] text-white font-light tracking-wide mb-2",children:ne[j]},j)}),e.jsx("p",{className:"text-[11px] text-white/40",children:"Premiere utilisation : chargement du modele IA"})]},"loading"),i==="viewfinder"&&e.jsxs(t.div,{variants:V,initial:"enter",animate:"center",exit:"exit",className:"flex flex-col items-center justify-center h-full",children:[e.jsxs("div",{className:"relative w-full max-w-[480px] mx-auto aspect-[3/4] sm:aspect-[4/3]",children:[e.jsx("video",{ref:G,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{background:"radial-gradient(ellipse at center, transparent 50%, rgba(0,0,0,0.5) 100%)"}}),e.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[e.jsx("div",{className:"absolute inset-0 border-[40px] sm:border-[60px] border-black/40"}),e.jsx(t.div,{variants:O,animate:"animate",className:"absolute top-8 left-8 sm:top-12 sm:left-12 w-8 h-8 border-t-2 border-l-2",style:{borderColor:l}}),e.jsx(t.div,{variants:O,animate:"animate",className:"absolute top-8 right-8 sm:top-12 sm:right-12 w-8 h-8 border-t-2 border-r-2",style:{borderColor:l}}),e.jsx(t.div,{variants:O,animate:"animate",className:"absolute bottom-8 left-8 sm:bottom-12 sm:left-12 w-8 h-8 border-b-2 border-l-2",style:{borderColor:l}}),e.jsx(t.div,{variants:O,animate:"animate",className:"absolute bottom-8 right-8 sm:bottom-12 sm:right-12 w-8 h-8 border-b-2 border-r-2",style:{borderColor:l}}),e.jsx(t.div,{variants:de,animate:"animate",className:"absolute left-10 right-10 sm:left-14 sm:right-14 h-[1px]",style:{background:`linear-gradient(90deg, transparent, ${l}80, transparent)`,top:"10%"}})]}),e.jsxs(t.div,{initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},transition:{type:"spring",stiffness:400,damping:20,delay:.3},className:"absolute top-12 sm:top-16 left-1/2 -translate-x-1/2 flex items-center gap-2 bg-black/60 backdrop-blur-sm px-3 py-1.5 rounded-full",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-400 animate-pulse"}),e.jsx("span",{className:"text-[10px] text-white/90 tracking-[0.1em] uppercase font-medium",children:"Pret"})]}),e.jsx(t.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.6,duration:.5},className:"absolute bottom-16 sm:bottom-20 left-0 right-0 text-center",children:e.jsx("p",{className:"text-[11px] text-white/80 tracking-[0.1em] font-light drop-shadow-md",children:"Centrez l'objet dans le cadre"})})]}),e.jsxs("div",{className:"relative mt-6",children:[e.jsx(t.div,{variants:me,animate:"animate",className:"absolute inset-[-6px] rounded-full border-2",style:{borderColor:l}}),e.jsx(t.button,{whileHover:{scale:1.1},whileTap:{scale:.9},transition:{type:"spring",stiffness:400,damping:20},onClick:b,className:"relative w-16 h-16 rounded-full border-4 border-white flex items-center justify-center","aria-label":"Capturer",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-white"})})]})]},"viewfinder"),i==="capturing"&&e.jsxs(t.div,{variants:V,initial:"enter",animate:"center",exit:"exit",className:"flex flex-col items-center justify-center h-full px-6",children:[w&&e.jsxs("div",{className:"relative mb-8",children:[e.jsx(t.div,{variants:he,animate:"animate",className:"absolute inset-[-6px] rounded-xl border-2 border-transparent",style:{borderImage:`conic-gradient(${l}, transparent 30%, ${l}) 1`}}),e.jsx(t.div,{variants:pe,initial:"initial",animate:"animate",className:"w-32 h-32 overflow-hidden border-2 border-white/20",style:{borderRadius:12},children:e.jsx("img",{src:w,alt:"Captured",className:"w-full h-full object-cover"})})]}),e.jsx("div",{className:"flex gap-2 mb-5",children:[0,1,2,3,4].map(a=>e.jsx(t.div,{animate:{y:[0,-8,0],opacity:[.4,1,.4]},transition:{duration:1,repeat:1/0,delay:a*.15,ease:d},className:"w-2 h-2 rounded-full",style:{backgroundColor:l}},a))}),e.jsx(P,{mode:"wait",children:e.jsx(t.p,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},transition:{duration:.3,ease:d},className:"text-[13px] text-white font-light tracking-wide",children:ce[z]},z)})]},"capturing"),i==="results"&&e.jsxs(t.div,{variants:V,initial:"enter",animate:"center",exit:"exit",className:"px-4 sm:px-6 py-6 max-w-[800px] mx-auto w-full relative",children:[k&&e.jsx("div",{className:"absolute top-8 left-1/2 -translate-x-1/2 pointer-events-none",children:Array.from({length:8}).map((a,C)=>e.jsx(t.div,{variants:be(C),initial:"initial",animate:"animate",className:"absolute w-2 h-2 rounded-full",style:{backgroundColor:l}},C))}),e.jsxs(t.div,{variants:xe,initial:"hidden",animate:"visible",children:[e.jsxs(t.div,{variants:F,className:"flex items-center gap-4 mb-5",children:[w&&e.jsx("div",{className:"w-16 h-16 rounded-lg overflow-hidden border border-white/20 shrink-0",children:e.jsx("img",{src:w,alt:"Captured",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-[10px] tracking-[0.2em] uppercase text-white/50 mb-1",children:"Objets detectes"}),e.jsx("p",{className:"text-[13px] text-white font-light truncate",children:y.map(a=>a.searchTerm).join(", ")})]}),e.jsxs(t.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:R,className:"flex items-center gap-1.5 text-[10px] tracking-[0.1em] uppercase text-[#c5a467] border border-[#c5a467]/40 px-3 py-2 hover:bg-[#c5a467]/10 transition-colors shrink-0",children:[e.jsx(W,{size:14}),"Reprendre"]})]}),e.jsx(t.div,{variants:F,className:"flex flex-wrap gap-2 mb-6",children:y.map(a=>e.jsxs(t.button,{variants:fe,whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>v(a.searchTerm),className:`text-[11px] px-3 py-1.5 border transition-all duration-200 ${_===a.searchTerm?"bg-[#c5a467] border-[#c5a467] text-white":"border-white/20 text-white/70 hover:border-white/40"}`,children:[a.searchTerm," ",e.jsxs("span",{className:"opacity-50",children:[a.confidence,"%"]})]},a.searchTerm))}),U?e.jsxs("div",{className:"flex items-center gap-3 py-8 justify-center",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/20 border-t-[#c5a467] rounded-full animate-spin"}),e.jsx("span",{className:"text-[12px] text-white/60",children:"Recherche en cours..."})]}):g.length>0?e.jsxs("div",{className:"space-y-1",children:[e.jsxs(t.p,{variants:F,className:"text-[10px] tracking-[0.2em] uppercase text-white/50 mb-3",children:[g.length," resultat",g.length!==1?"s":""," ",'pour "',_,'"']}),g.map(a=>e.jsxs(t.button,{variants:F,onClick:()=>A(a.id),className:"relative w-full flex items-center gap-4 py-3 px-2 hover:bg-white/5 transition-colors rounded group overflow-hidden",children:[e.jsx(t.div,{className:"absolute left-0 top-0 bottom-0 w-[3px] origin-top",style:{backgroundColor:l},initial:{scaleY:0},whileHover:{scaleY:1},transition:{type:"spring",stiffness:400,damping:20}}),e.jsx("div",{className:"w-12 h-16 sm:w-14 sm:h-18 bg-white/10 overflow-hidden shrink-0 rounded",children:e.jsx("img",{src:a.image,alt:a.name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 text-left min-w-0",children:[e.jsx("p",{className:"text-[10px] tracking-[0.15em] uppercase text-[#c5a467]",children:a.category}),e.jsx("p",{className:"text-[13px] text-white font-light truncate",children:a.name}),e.jsx("p",{className:"text-[12px] text-white/80 font-medium",children:se(a.price)})]})]},a.id))]}):e.jsxs(t.div,{variants:X,initial:"initial",animate:"shake",className:"py-8 text-center",children:[e.jsxs("p",{className:"text-[13px] text-white/60 font-light mb-4",children:['Aucun produit trouve pour "',e.jsx("span",{className:"text-white",children:_}),'"']}),e.jsx(t.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:R,className:"text-[11px] tracking-[0.1em] uppercase text-[#c5a467] border border-[#c5a467]/40 px-4 py-2.5 hover:bg-[#c5a467]/10 transition-colors",children:"Reessayer"})]})]})]},"results"),i==="error"&&e.jsxs(t.div,{variants:V,initial:"enter",animate:"center",exit:"exit",className:"flex flex-col items-center justify-center h-full px-6 text-center",children:[w&&e.jsx("div",{className:"w-24 h-24 rounded-lg overflow-hidden mb-6 border-2 border-white/10",children:e.jsx("img",{src:w,alt:"Captured",className:"w-full h-full object-cover"})}),e.jsx(t.div,{variants:X,initial:"initial",animate:"shake",children:e.jsx(t.div,{variants:ge,animate:"animate",className:"bg-red-500/10 border border-red-500/30 rounded-lg px-5 py-4 mb-6 max-w-[400px]",children:e.jsx("p",{className:"text-[13px] text-red-300 font-light",children:B})})}),e.jsxs(t.button,{whileHover:{scale:1.05},whileTap:{scale:.95},transition:{type:"spring",stiffness:500,damping:15},onClick:R,className:"flex items-center gap-2 text-[11px] tracking-[0.1em] uppercase text-[#c5a467] border border-[#c5a467]/40 px-5 py-2.5 hover:bg-[#c5a467]/10 transition-colors",children:[e.jsx(W,{size:14}),"Reessayer"]})]},"error")]})]})]},"camera-overlay")}):null};export{ye as default};
