const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BVq57eW8.js","assets/graph_model-XMA4b7cK.js","assets/index-BfBVz66r.js","assets/index-B8YJ4Nmf.css","assets/mobilenet.esm-B917t3d7.js"])))=>i.map(i=>d[i]);
import{r as a,e as U,m as O,_ as P,u as V,j as e,A as $,a as o,H as F,b as I,f as q}from"./index-BfBVz66r.js";const B=`${U.API_URL}/api/products`,C={handbag:"sac a main",purse:"sac a main",clutch:"pochette",bag:"sac",shopping_basket:"sac",plastic_bag:"sac",mailbag:"sac",backpack:"sac a dos",knapsack:"sac a dos",pack:"sac a dos",sandal:"sandales",running_shoe:"baskets",sneaker:"baskets",shoe_shop:"chaussures",loafer:"chaussures",boot:"chaussures",clog:"chaussures",oxford:"chaussures",wallet:"portefeuille",billfold:"portefeuille",sunglass:"lunettes",sunglasses:"lunettes",eyeglass:"lunettes",watch:"montre",digital_watch:"montre",analog_clock:"montre",necklace:"bijoux",bracelet:"bijoux",ring:"bijoux",perfume:"parfum",lotion:"parfum",jersey:"vetements",shirt:"vetements",dress:"vetements",suit:"vetements",jean:"vetements",miniskirt:"vetements",skirt:"vetements",coat:"vetements",trench_coat:"vetements",poncho:"vetements",kimono:"vetements",bikini:"vetements",swimming_trunks:"vetements",pajama:"vetements",bow_tie:"vetements",neck_brace:"accessoires",hat:"chapeau",sombrero:"chapeau",cap:"casquette",scarf:"foulard",stole:"foulard",umbrella:"parapluie",belt:"ceinture",buckle:"ceinture"},W=()=>{const[v,c]=a.useState("idle"),[_,s]=a.useState(""),[R,p]=a.useState([]),[j,u]=a.useState(""),[T,l]=a.useState([]),[E,N]=a.useState(!1),[y,g]=a.useState(""),i=a.useRef(null),x=a.useRef(null),f=a.useRef(null),b=a.useRef(null),d=a.useCallback(()=>{f.current&&(f.current.getTracks().forEach(r=>r.stop()),f.current=null)},[]),t=a.useCallback(async r=>{u(r),N(!0);try{const n=await fetch(`${B}?search=${encodeURIComponent(r)}&limit=8`);if(!n.ok)throw new Error("Search failed");const m=await n.json();l(m.products.map(O))}catch{l([])}finally{N(!1)}},[]),L=r=>{const m=r.toLowerCase().replace(/,/g,"").split(/[\s_]+/);for(const w of r.split(", ")){const h=w.trim().toLowerCase().replace(/\s+/g,"_");if(C[h])return C[h]}for(const w of m)if(C[w])return C[w];return null},z=a.useCallback(async()=>{if(s(""),p([]),l([]),u(""),g(""),!navigator.mediaDevices?.getUserMedia){c("error"),s("Votre navigateur ne supporte pas l'acces a la camera.");return}c("loading-model");try{const[r,n]=await Promise.all([(async()=>{if(b.current)return null;await(await P(()=>import("./index-BVq57eW8.js"),__vite__mapDeps([0,1,2,3]))).ready();const h=await(await P(()=>import("./mobilenet.esm-B917t3d7.js"),__vite__mapDeps([4,1,2,3]))).load({version:2,alpha:1});return b.current=h,null})(),navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:"environment"},width:{ideal:640},height:{ideal:480}},audio:!1}).catch(m=>{throw m.name==="NotAllowedError"?new Error("Acces a la camera refuse. Autorisez l'acces dans les parametres."):m.name==="NotFoundError"?new Error("Aucune camera detectee sur cet appareil."):new Error("Impossible d'acceder a la camera. Verifiez vos permissions.")})]);f.current=n,i.current&&(i.current.srcObject=n,await i.current.play()),c("viewfinder")}catch(r){d(),c("error"),s(r?.message||"Impossible de charger le modele. Verifiez votre connexion.")}},[d]),H=a.useCallback(async()=>{if(!i.current||!x.current||!b.current)return;c("capturing");const r=i.current,n=x.current;n.width=r.videoWidth,n.height=r.videoHeight;const m=n.getContext("2d");if(m){m.drawImage(r,0,0),g(n.toDataURL("image/jpeg",.8)),d();try{const w=await b.current.classify(n,5),h=[],A=new Set;for(const S of w){const k=L(S.className);k&&!A.has(k)&&(A.add(k),h.push({label:S.className.split(",")[0].trim(),searchTerm:k,confidence:Math.round(S.probability*100)}))}if(h.length===0){c("error"),s("Objet non reconnu. Essayez un autre angle ou meilleur eclairage.");return}p(h),c("results"),await t(h[0].searchTerm)}catch{c("error"),s("Erreur lors de l'analyse de l'image. Reessayez.")}}},[d,t]),M=a.useCallback(async()=>{p([]),l([]),u(""),g(""),s(""),c("loading-model");try{const r=await navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:"environment"},width:{ideal:640},height:{ideal:480}},audio:!1});f.current=r,i.current&&(i.current.srcObject=r,await i.current.play()),c("viewfinder")}catch{c("error"),s("Impossible de reactiver la camera.")}},[]),D=a.useCallback(()=>{d(),c("idle"),s(""),p([]),l([]),u(""),g("")},[d]);return a.useEffect(()=>()=>{d()},[d]),{state:v,error:_,detectedCategories:R,activeSearchTerm:j,results:T,searchLoading:E,capturedImage:y,videoRef:i,canvasRef:x,open:z,capture:H,retake:M,close:D,searchProducts:t}},G=({isOpen:v,onClose:c})=>{const _=V(),{state:s,error:R,detectedCategories:p,activeSearchTerm:j,results:u,searchLoading:T,capturedImage:l,videoRef:E,canvasRef:N,open:y,capture:g,retake:i,close:x,searchProducts:f}=W();a.useEffect(()=>{v&&s==="idle"&&y(),!v&&s!=="idle"&&x()},[v,s,y,x]);const b=()=>{x(),c()},d=t=>{b(),_(`/product/${t}`)};return v?e.jsx($,{children:e.jsxs(o.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 z-[120] bg-[#19110b] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 sm:px-6 h-14 shrink-0 bg-black/30 backdrop-blur-sm z-10",children:[e.jsx("span",{className:"text-[11px] font-medium tracking-[0.15em] uppercase text-white/80",children:"Recherche Camera"}),e.jsx(o.button,{whileHover:{rotate:90},whileTap:{scale:.9},transition:{duration:.3},onClick:b,className:"text-white p-1.5 hover:bg-white/10 rounded-full transition-colors","aria-label":"Fermer",children:e.jsx(F,{size:24})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto relative",children:[e.jsx("canvas",{ref:N,className:"hidden"}),s==="loading-model"&&e.jsxs(o.div,{initial:{opacity:0},animate:{opacity:1},className:"flex flex-col items-center justify-center h-full px-6 text-center",children:[e.jsx("div",{className:"w-12 h-12 border-3 border-white/20 border-t-[#c5a467] rounded-full animate-spin mb-6"}),e.jsx("p",{className:"text-[14px] text-white font-light tracking-wide mb-2",children:"Chargement du modele de reconnaissance..."}),e.jsx("p",{className:"text-[11px] text-white/40",children:"Premiere utilisation : environ 10 secondes"})]}),s==="viewfinder"&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[e.jsxs("div",{className:"relative w-full max-w-[480px] mx-auto aspect-[3/4] sm:aspect-[4/3]",children:[e.jsx("video",{ref:E,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[e.jsx("div",{className:"absolute inset-0 border-[40px] sm:border-[60px] border-black/40"}),e.jsx("div",{className:"absolute top-8 left-8 sm:top-12 sm:left-12 w-8 h-8 border-t-2 border-l-2 border-[#c5a467]"}),e.jsx("div",{className:"absolute top-8 right-8 sm:top-12 sm:right-12 w-8 h-8 border-t-2 border-r-2 border-[#c5a467]"}),e.jsx("div",{className:"absolute bottom-8 left-8 sm:bottom-12 sm:left-12 w-8 h-8 border-b-2 border-l-2 border-[#c5a467]"}),e.jsx("div",{className:"absolute bottom-8 right-8 sm:bottom-12 sm:right-12 w-8 h-8 border-b-2 border-r-2 border-[#c5a467]"})]}),e.jsx("div",{className:"absolute bottom-16 sm:bottom-20 left-0 right-0 text-center",children:e.jsx("p",{className:"text-[11px] text-white/80 tracking-[0.1em] font-light drop-shadow-md",children:"Centrez l'objet dans le cadre"})})]}),e.jsx(o.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:g,className:"mt-6 w-16 h-16 rounded-full border-4 border-white flex items-center justify-center","aria-label":"Capturer",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-white"})})]}),s==="capturing"&&e.jsxs(o.div,{initial:{opacity:0},animate:{opacity:1},className:"flex flex-col items-center justify-center h-full px-6",children:[l&&e.jsx("div",{className:"w-32 h-32 rounded-lg overflow-hidden mb-6 border-2 border-white/20",children:e.jsx("img",{src:l,alt:"Captured",className:"w-full h-full object-cover"})}),e.jsx("div",{className:"w-8 h-8 border-3 border-white/20 border-t-[#c5a467] rounded-full animate-spin mb-4"}),e.jsx("p",{className:"text-[13px] text-white font-light tracking-wide",children:"Analyse en cours..."})]}),s==="results"&&e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},className:"px-4 sm:px-6 py-6 max-w-[800px] mx-auto w-full",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-5",children:[l&&e.jsx("div",{className:"w-16 h-16 rounded-lg overflow-hidden border border-white/20 shrink-0",children:e.jsx("img",{src:l,alt:"Captured",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-[10px] tracking-[0.2em] uppercase text-white/50 mb-1",children:"Objets detectes"}),e.jsx("p",{className:"text-[13px] text-white font-light truncate",children:p.map(t=>t.searchTerm).join(", ")})]}),e.jsxs(o.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:i,className:"flex items-center gap-1.5 text-[10px] tracking-[0.1em] uppercase text-[#c5a467] border border-[#c5a467]/40 px-3 py-2 hover:bg-[#c5a467]/10 transition-colors shrink-0",children:[e.jsx(I,{size:14}),"Reprendre"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-6",children:p.map(t=>e.jsxs(o.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>f(t.searchTerm),className:`text-[11px] px-3 py-1.5 border transition-all duration-200 ${j===t.searchTerm?"bg-[#c5a467] border-[#c5a467] text-white":"border-white/20 text-white/70 hover:border-white/40"}`,children:[t.searchTerm," ",e.jsxs("span",{className:"opacity-50",children:[t.confidence,"%"]})]},t.searchTerm))}),T?e.jsxs("div",{className:"flex items-center gap-3 py-8 justify-center",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/20 border-t-[#c5a467] rounded-full animate-spin"}),e.jsx("span",{className:"text-[12px] text-white/60",children:"Recherche en cours..."})]}):u.length>0?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-[10px] tracking-[0.2em] uppercase text-white/50 mb-3",children:[u.length," resultat",u.length!==1?"s":""," ",'pour "',j,'"']}),u.map(t=>e.jsxs(o.button,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},onClick:()=>d(t.id),className:"w-full flex items-center gap-4 py-3 px-2 hover:bg-white/5 transition-colors rounded",children:[e.jsx("div",{className:"w-12 h-16 sm:w-14 sm:h-18 bg-white/10 overflow-hidden shrink-0 rounded",children:e.jsx("img",{src:t.image,alt:t.name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 text-left min-w-0",children:[e.jsx("p",{className:"text-[10px] tracking-[0.15em] uppercase text-[#c5a467]",children:t.category}),e.jsx("p",{className:"text-[13px] text-white font-light truncate",children:t.name}),e.jsx("p",{className:"text-[12px] text-white/80 font-medium",children:q(t.price)})]})]},t.id))]}):e.jsxs("div",{className:"py-8 text-center",children:[e.jsxs("p",{className:"text-[13px] text-white/60 font-light mb-4",children:['Aucun produit trouve pour "',e.jsx("span",{className:"text-white",children:j}),'"']}),e.jsx(o.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:i,className:"text-[11px] tracking-[0.1em] uppercase text-[#c5a467] border border-[#c5a467]/40 px-4 py-2.5 hover:bg-[#c5a467]/10 transition-colors",children:"Reessayer"})]})]}),s==="error"&&e.jsxs(o.div,{initial:{opacity:0},animate:{opacity:1},className:"flex flex-col items-center justify-center h-full px-6 text-center",children:[l&&e.jsx("div",{className:"w-24 h-24 rounded-lg overflow-hidden mb-6 border-2 border-white/10",children:e.jsx("img",{src:l,alt:"Captured",className:"w-full h-full object-cover"})}),e.jsx("div",{className:"bg-red-500/10 border border-red-500/30 rounded-lg px-5 py-4 mb-6 max-w-[400px]",children:e.jsx("p",{className:"text-[13px] text-red-300 font-light",children:R})}),e.jsxs(o.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:i,className:"flex items-center gap-2 text-[11px] tracking-[0.1em] uppercase text-[#c5a467] border border-[#c5a467]/40 px-5 py-2.5 hover:bg-[#c5a467]/10 transition-colors",children:[e.jsx(I,{size:14}),"Reessayer"]})]})]})]})}):null};export{G as default};
