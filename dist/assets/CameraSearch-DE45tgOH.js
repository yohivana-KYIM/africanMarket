const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DivgwGjs.js","assets/graph_model-CYvLp1Ez.js","assets/index-Dk5bDSBR.js","assets/index-BdbK4Btv.css","assets/mobilenet.esm-9E1PO0h6.js"])))=>i.map(i=>d[i]);
import{r as a,e as U,m as O,_ as P,u as V,j as e,A as $,a as l,H as F,b as I,f as q}from"./index-Dk5bDSBR.js";const B=`${U.API_URL}/api/products`,C={handbag:"sac a main",purse:"sac a main",clutch:"pochette",bag:"sac",shopping_basket:"sac",plastic_bag:"sac",mailbag:"sac",backpack:"sac a dos",knapsack:"sac a dos",pack:"sac a dos",sandal:"sandales",running_shoe:"baskets",sneaker:"baskets",shoe_shop:"chaussures",loafer:"chaussures",boot:"chaussures",clog:"chaussures",oxford:"chaussures",wallet:"portefeuille",billfold:"portefeuille",sunglass:"lunettes",sunglasses:"lunettes",eyeglass:"lunettes",watch:"montre",digital_watch:"montre",analog_clock:"montre",necklace:"bijoux",bracelet:"bijoux",ring:"bijoux",perfume:"parfum",lotion:"parfum",jersey:"vetements",shirt:"vetements",dress:"vetements",suit:"vetements",jean:"vetements",miniskirt:"vetements",skirt:"vetements",coat:"vetements",trench_coat:"vetements",poncho:"vetements",kimono:"vetements",bikini:"vetements",swimming_trunks:"vetements",pajama:"vetements",bow_tie:"vetements",neck_brace:"accessoires",hat:"chapeau",sombrero:"chapeau",cap:"casquette",scarf:"foulard",stole:"foulard",umbrella:"parapluie",belt:"ceinture",buckle:"ceinture"},W=()=>{const[x,c]=a.useState("idle"),[_,r]=a.useState(""),[R,f]=a.useState([]),[j,m]=a.useState(""),[E,i]=a.useState([]),[T,N]=a.useState(!1),[y,g]=a.useState(""),u=a.useRef(null),b=a.useRef(null),h=a.useRef(null),w=a.useRef(null),o=a.useCallback(()=>{h.current&&(h.current.getTracks().forEach(s=>s.stop()),h.current=null)},[]),t=a.useCallback(async s=>{m(s),N(!0);try{const n=await fetch(`${B}?search=${encodeURIComponent(s)}&limit=8`);if(!n.ok)throw new Error("Search failed");const d=await n.json();i(d.products.map(O))}catch{i([])}finally{N(!1)}},[]),L=s=>{const d=s.toLowerCase().replace(/,/g,"").split(/[\s_]+/);for(const v of s.split(", ")){const p=v.trim().toLowerCase().replace(/\s+/g,"_");if(C[p])return C[p]}for(const v of d)if(C[v])return C[v];return null},z=a.useCallback(async()=>{if(r(""),f([]),i([]),m(""),g(""),!navigator.mediaDevices?.getUserMedia){c("error"),r("Votre navigateur ne supporte pas l'acces a la camera.");return}c("loading-model");try{const[s,n]=await Promise.all([(async()=>{if(w.current)return null;await(await P(()=>import("./index-DivgwGjs.js"),__vite__mapDeps([0,1,2,3]))).ready();const p=await(await P(()=>import("./mobilenet.esm-9E1PO0h6.js"),__vite__mapDeps([4,1,2,3]))).load({version:2,alpha:1});return w.current=p,null})(),navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:"environment"},width:{ideal:640},height:{ideal:480}},audio:!1}).catch(d=>{throw d.name==="NotAllowedError"?new Error("Acces a la camera refuse. Autorisez l'acces dans les parametres."):d.name==="NotFoundError"?new Error("Aucune camera detectee sur cet appareil."):new Error("Impossible d'acceder a la camera. Verifiez vos permissions.")})]);h.current=n,c("viewfinder")}catch(s){o(),c("error"),r(s?.message||"Impossible de charger le modele. Verifiez votre connexion.")}},[o]),H=a.useCallback(async()=>{if(!u.current||!b.current||!w.current)return;c("capturing");const s=u.current,n=b.current;n.width=s.videoWidth,n.height=s.videoHeight;const d=n.getContext("2d");if(d){d.drawImage(s,0,0),g(n.toDataURL("image/jpeg",.8)),o();try{const v=await w.current.classify(n,5),p=[],A=new Set;for(const S of v){const k=L(S.className);k&&!A.has(k)&&(A.add(k),p.push({label:S.className.split(",")[0].trim(),searchTerm:k,confidence:Math.round(S.probability*100)}))}if(p.length===0){c("error"),r("Objet non reconnu. Essayez un autre angle ou meilleur eclairage.");return}f(p),c("results"),await t(p[0].searchTerm)}catch{c("error"),r("Erreur lors de l'analyse de l'image. Reessayez.")}}},[o,t]),M=a.useCallback(async()=>{f([]),i([]),m(""),g(""),r(""),c("loading-model");try{const s=await navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:"environment"},width:{ideal:640},height:{ideal:480}},audio:!1});h.current=s,c("viewfinder")}catch{c("error"),r("Impossible de reactiver la camera.")}},[]),D=a.useCallback(()=>{o(),c("idle"),r(""),f([]),i([]),m(""),g("")},[o]);return a.useEffect(()=>{if(x==="viewfinder"&&u.current&&h.current){const s=u.current;s.srcObject||(s.srcObject=h.current,s.play().catch(()=>{}))}},[x]),a.useEffect(()=>()=>{o()},[o]),{state:x,error:_,detectedCategories:R,activeSearchTerm:j,results:E,searchLoading:T,capturedImage:y,videoRef:u,canvasRef:b,open:z,capture:H,retake:M,close:D,searchProducts:t}},G=({isOpen:x,onClose:c})=>{const _=V(),{state:r,error:R,detectedCategories:f,activeSearchTerm:j,results:m,searchLoading:E,capturedImage:i,videoRef:T,canvasRef:N,open:y,capture:g,retake:u,close:b,searchProducts:h}=W();a.useEffect(()=>{x&&r==="idle"&&y(),!x&&r!=="idle"&&b()},[x,r,y,b]);const w=()=>{b(),c()},o=t=>{w(),_(`/product/${t}`)};return x?e.jsx($,{children:e.jsxs(l.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 z-[120] bg-[#19110b] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 sm:px-6 h-14 shrink-0 bg-black/30 backdrop-blur-sm z-10",children:[e.jsx("span",{className:"text-[11px] font-medium tracking-[0.15em] uppercase text-white/80",children:"Recherche Camera"}),e.jsx(l.button,{whileHover:{rotate:90},whileTap:{scale:.9},transition:{duration:.3},onClick:w,className:"text-white p-1.5 hover:bg-white/10 rounded-full transition-colors","aria-label":"Fermer",children:e.jsx(F,{size:24})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto relative",children:[e.jsx("canvas",{ref:N,className:"hidden"}),r==="loading-model"&&e.jsxs(l.div,{initial:{opacity:0},animate:{opacity:1},className:"flex flex-col items-center justify-center h-full px-6 text-center",children:[e.jsx("div",{className:"w-12 h-12 border-3 border-white/20 border-t-[#c5a467] rounded-full animate-spin mb-6"}),e.jsx("p",{className:"text-[14px] text-white font-light tracking-wide mb-2",children:"Chargement du modele de reconnaissance..."}),e.jsx("p",{className:"text-[11px] text-white/40",children:"Premiere utilisation : environ 10 secondes"})]}),r==="viewfinder"&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[e.jsxs("div",{className:"relative w-full max-w-[480px] mx-auto aspect-[3/4] sm:aspect-[4/3]",children:[e.jsx("video",{ref:T,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[e.jsx("div",{className:"absolute inset-0 border-[40px] sm:border-[60px] border-black/40"}),e.jsx("div",{className:"absolute top-8 left-8 sm:top-12 sm:left-12 w-8 h-8 border-t-2 border-l-2 border-[#c5a467]"}),e.jsx("div",{className:"absolute top-8 right-8 sm:top-12 sm:right-12 w-8 h-8 border-t-2 border-r-2 border-[#c5a467]"}),e.jsx("div",{className:"absolute bottom-8 left-8 sm:bottom-12 sm:left-12 w-8 h-8 border-b-2 border-l-2 border-[#c5a467]"}),e.jsx("div",{className:"absolute bottom-8 right-8 sm:bottom-12 sm:right-12 w-8 h-8 border-b-2 border-r-2 border-[#c5a467]"})]}),e.jsx("div",{className:"absolute bottom-16 sm:bottom-20 left-0 right-0 text-center",children:e.jsx("p",{className:"text-[11px] text-white/80 tracking-[0.1em] font-light drop-shadow-md",children:"Centrez l'objet dans le cadre"})})]}),e.jsx(l.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:g,className:"mt-6 w-16 h-16 rounded-full border-4 border-white flex items-center justify-center","aria-label":"Capturer",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-white"})})]}),r==="capturing"&&e.jsxs(l.div,{initial:{opacity:0},animate:{opacity:1},className:"flex flex-col items-center justify-center h-full px-6",children:[i&&e.jsx("div",{className:"w-32 h-32 rounded-lg overflow-hidden mb-6 border-2 border-white/20",children:e.jsx("img",{src:i,alt:"Captured",className:"w-full h-full object-cover"})}),e.jsx("div",{className:"w-8 h-8 border-3 border-white/20 border-t-[#c5a467] rounded-full animate-spin mb-4"}),e.jsx("p",{className:"text-[13px] text-white font-light tracking-wide",children:"Analyse en cours..."})]}),r==="results"&&e.jsxs(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},className:"px-4 sm:px-6 py-6 max-w-[800px] mx-auto w-full",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-5",children:[i&&e.jsx("div",{className:"w-16 h-16 rounded-lg overflow-hidden border border-white/20 shrink-0",children:e.jsx("img",{src:i,alt:"Captured",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-[10px] tracking-[0.2em] uppercase text-white/50 mb-1",children:"Objets detectes"}),e.jsx("p",{className:"text-[13px] text-white font-light truncate",children:f.map(t=>t.searchTerm).join(", ")})]}),e.jsxs(l.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:u,className:"flex items-center gap-1.5 text-[10px] tracking-[0.1em] uppercase text-[#c5a467] border border-[#c5a467]/40 px-3 py-2 hover:bg-[#c5a467]/10 transition-colors shrink-0",children:[e.jsx(I,{size:14}),"Reprendre"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-6",children:f.map(t=>e.jsxs(l.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>h(t.searchTerm),className:`text-[11px] px-3 py-1.5 border transition-all duration-200 ${j===t.searchTerm?"bg-[#c5a467] border-[#c5a467] text-white":"border-white/20 text-white/70 hover:border-white/40"}`,children:[t.searchTerm," ",e.jsxs("span",{className:"opacity-50",children:[t.confidence,"%"]})]},t.searchTerm))}),E?e.jsxs("div",{className:"flex items-center gap-3 py-8 justify-center",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/20 border-t-[#c5a467] rounded-full animate-spin"}),e.jsx("span",{className:"text-[12px] text-white/60",children:"Recherche en cours..."})]}):m.length>0?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-[10px] tracking-[0.2em] uppercase text-white/50 mb-3",children:[m.length," resultat",m.length!==1?"s":""," ",'pour "',j,'"']}),m.map(t=>e.jsxs(l.button,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},onClick:()=>o(t.id),className:"w-full flex items-center gap-4 py-3 px-2 hover:bg-white/5 transition-colors rounded",children:[e.jsx("div",{className:"w-12 h-16 sm:w-14 sm:h-18 bg-white/10 overflow-hidden shrink-0 rounded",children:e.jsx("img",{src:t.image,alt:t.name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 text-left min-w-0",children:[e.jsx("p",{className:"text-[10px] tracking-[0.15em] uppercase text-[#c5a467]",children:t.category}),e.jsx("p",{className:"text-[13px] text-white font-light truncate",children:t.name}),e.jsx("p",{className:"text-[12px] text-white/80 font-medium",children:q(t.price)})]})]},t.id))]}):e.jsxs("div",{className:"py-8 text-center",children:[e.jsxs("p",{className:"text-[13px] text-white/60 font-light mb-4",children:['Aucun produit trouve pour "',e.jsx("span",{className:"text-white",children:j}),'"']}),e.jsx(l.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:u,className:"text-[11px] tracking-[0.1em] uppercase text-[#c5a467] border border-[#c5a467]/40 px-4 py-2.5 hover:bg-[#c5a467]/10 transition-colors",children:"Reessayer"})]})]}),r==="error"&&e.jsxs(l.div,{initial:{opacity:0},animate:{opacity:1},className:"flex flex-col items-center justify-center h-full px-6 text-center",children:[i&&e.jsx("div",{className:"w-24 h-24 rounded-lg overflow-hidden mb-6 border-2 border-white/10",children:e.jsx("img",{src:i,alt:"Captured",className:"w-full h-full object-cover"})}),e.jsx("div",{className:"bg-red-500/10 border border-red-500/30 rounded-lg px-5 py-4 mb-6 max-w-[400px]",children:e.jsx("p",{className:"text-[13px] text-red-300 font-light",children:R})}),e.jsxs(l.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:u,className:"flex items-center gap-2 text-[11px] tracking-[0.1em] uppercase text-[#c5a467] border border-[#c5a467]/40 px-5 py-2.5 hover:bg-[#c5a467]/10 transition-colors",children:[e.jsx(I,{size:14}),"Reessayer"]})]})]})]})}):null};export{G as default};
